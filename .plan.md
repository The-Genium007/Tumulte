# Plan de Refonte Responsive & PWA - Tumulte

## Résumé

Rendre l'application Tumulte accessible sur mobile, tablette et desktop avec :
- Navigation mobile (bottom bar)
- Layouts responsive pour toutes les pages
- Installation PWA sur tous les supports (mobile + desktop)
- Message de limitation pour l'Overlay Studio sur mobile

---

## Phase 1 : Infrastructure PWA Desktop

### 1.1 Composant PWA Install Prompt

**Fichier à créer** : `frontend/components/PwaInstallPrompt.vue`

**Fonctionnalités** :
- Écoute l'événement `beforeinstallprompt` du navigateur
- Stocke la possibilité d'installer en localStorage (ne pas afficher si déjà refusé)
- Affiche une bannière en haut de page au premier chargement
- Bouton "Installer" + "Plus tard" + icône fermer

**Structure** :
```vue
<template>
  <Transition>
    <div v-if="showBanner" class="fixed top-0 inset-x-0 z-50 bg-primary-600 text-white p-3">
      <div class="container mx-auto flex items-center justify-between">
        <div class="flex items-center gap-3">
          <UIcon name="i-lucide-download" />
          <span>Installez Tumulte pour un accès rapide</span>
        </div>
        <div class="flex items-center gap-2">
          <UButton @click="installApp">Installer</UButton>
          <UButton variant="ghost" @click="dismissBanner">Plus tard</UButton>
        </div>
      </div>
    </div>
  </Transition>
</template>
```

### 1.2 Bouton dans le Menu Utilisateur

**Fichier à modifier** : `frontend/components/UserMenu.vue`

**Ajout** :
- Item "Installer l'application" avec icône download
- Visible uniquement si `beforeinstallprompt` est disponible
- Utilise le même composable que la bannière

### 1.3 Composable usePwaInstall

**Fichier à créer** : `frontend/composables/usePwaInstall.ts`

**Fonctionnalités** :
```typescript
export function usePwaInstall() {
  const deferredPrompt = ref<BeforeInstallPromptEvent | null>(null)
  const canInstall = computed(() => !!deferredPrompt.value)
  const dismissed = useLocalStorage('pwa-install-dismissed', false)

  const install = async () => { /* trigger prompt */ }
  const dismiss = () => { dismissed.value = true }

  return { canInstall, dismissed, install, dismiss }
}
```

---

## Phase 2 : Navigation Mobile (Bottom Bar)

### 2.1 Composant BottomNavigation

**Fichier à créer** : `frontend/components/BottomNavigation.vue`

**Structure** :
- Barre fixe en bas (`fixed bottom-0 inset-x-0`)
- Hauteur : 64px (avec safe-area-inset-bottom pour iPhone)
- 3-4 items selon le rôle (MJ ou Streamer)
- Visible uniquement sur mobile (`lg:hidden`)

**Items pour MJ** :
| Icône | Label | Route |
|-------|-------|-------|
| `i-lucide-home` | Accueil | `/mj` |
| `i-lucide-folder` | Campagnes | `/mj/campaigns` |
| `i-lucide-settings` | Réglages | `/settings` |

**Items pour Streamer** :
| Icône | Label | Route |
|-------|-------|-------|
| `i-lucide-home` | Accueil | `/streamer` |
| `i-lucide-mail` | Invitations | `/streamer/campaigns` |
| `i-lucide-settings` | Réglages | `/settings` |

**Design** :
```vue
<template>
  <nav class="fixed bottom-0 inset-x-0 bg-white border-t border-neutral-200 lg:hidden z-40 safe-area-bottom">
    <div class="flex items-center justify-around h-16">
      <NuxtLink
        v-for="item in items"
        :to="item.to"
        class="flex flex-col items-center justify-center flex-1 h-full"
        :class="isActive(item.to) ? 'text-primary-600' : 'text-neutral-500'"
      >
        <UIcon :name="item.icon" class="size-6" />
        <span class="text-xs mt-1">{{ item.label }}</span>
      </NuxtLink>
    </div>
  </nav>
</template>
```

### 2.2 Adaptation du Layout Authenticated

**Fichier à modifier** : `frontend/layouts/authenticated.vue`

**Modifications** :
- Ajouter `<BottomNavigation />` après le contenu
- Ajouter padding-bottom sur le contenu principal pour éviter chevauchement (`pb-20 lg:pb-0`)
- Masquer certains éléments du header sur mobile si redondants

### 2.3 CSS Safe Area

**Fichier à modifier** : `frontend/assets/css/main.css`

**Ajout** :
```css
.safe-area-bottom {
  padding-bottom: env(safe-area-inset-bottom, 0px);
}

.safe-area-top {
  padding-top: env(safe-area-inset-top, 0px);
}
```

---

## Phase 3 : Pages MJ - Responsive

### 3.1 Page MJ Index (`/mj`)

**Fichier** : `frontend/pages/mj/index.vue`

**État actuel** :
- CampaignSelectorCard (OK)
- CampaignDashboard avec grid `lg:grid-cols-[7fr_3fr]` (OK - devient 1 colonne sur mobile)
- EventsCard (OK)
- PollControlCard (PROBLÈME : `grid-cols-3` fixe)

**Modifications** :
1. **PollControlCard** : Adapter le grid des options
   - Mobile : `grid-cols-1` (options empilées)
   - Tablette : `grid-cols-2`
   - Desktop : `grid-cols-3`

2. **Ordre mobile** : Réorganiser pour mettre les éléments les plus utilisés en haut
   - PollControlCard en premier (si sondage actif)
   - EventsCard
   - CampaignDashboard

### 3.2 Composant CampaignDashboard

**Fichier** : `frontend/components/mj/CampaignDashboard.vue`

**État actuel** : `grid grid-cols-1 lg:grid-cols-[7fr_3fr] gap-6 max-h-[420px]`

**Modifications** :
- Mobile : Stack vertical, supprimer max-height
- Tablette : Garder le stack ou 2 colonnes égales
- Desktop : Layout actuel

```vue
<div class="grid grid-cols-1 lg:grid-cols-[7fr_3fr] gap-4 lg:gap-6">
  <!-- Sur mobile: max-height plus grand ou scroll -->
  <MjRecentEventsColumn :max-height="isMobile ? '300px' : '420px'" />
  <MjPlayersColumn :max-height="isMobile ? '250px' : '420px'" />
</div>
```

### 3.3 Composant EventsCard

**Fichier** : `frontend/components/mj/EventsCard.vue`

**Modifications** :
- Réduire padding sur mobile
- Bouton "Ajouter" : icône seule sur mobile, avec label sur desktop

### 3.4 Composant EventRow

**Fichier** : `frontend/components/mj/EventRow.vue`

**Modifications** :
- Réduire la hauteur sur mobile (h-12 au lieu de h-14)
- Texte de la question : truncate avec ellipsis
- Durée : format court sur mobile (`1m` au lieu de `1 min`)

### 3.5 Page Création Campaign (`/mj/campaigns/create`)

**Fichier** : `frontend/pages/mj/campaigns/create.vue`

**État actuel** : `max-w-300 w-1/3` (trop étroit sur mobile)

**Modifications** :
- Mobile : `w-full px-4`
- Tablette : `max-w-md mx-auto`
- Desktop : garder le layout actuel

### 3.6 Page Détail Campaign (`/mj/campaigns/[id]`)

**Fichier** : `frontend/pages/mj/campaigns/[id]/index.vue`

**Modifications** :
- Cartes membres : adapter le layout des lignes
- Boutons d'action : stack vertical sur mobile
- Modal d'invitation : adapter la largeur

### 3.7 Pages Création/Édition Poll

**Fichiers** :
- `frontend/pages/mj/campaigns/[id]/polls/create.vue`
- `frontend/pages/mj/campaigns/[id]/polls/[pollId]/edit.vue`

**Modifications** :
- Formulaire pleine largeur sur mobile
- Boutons de durée : 2 par ligne sur mobile au lieu de 4
- Options de sondage : champ + bouton supprimer sur la même ligne mais adapté

---

## Phase 4 : Pages Streamer - Responsive

### 4.1 Page Streamer Index (`/streamer`)

**Fichier** : `frontend/pages/streamer/index.vue`

**Modifications** :
- Cards en stack vertical (déjà le cas)
- Boutons d'action : adapter la taille
- URL Overlay : texte tronqué + bouton copier visible

### 4.2 Page Campaigns/Invitations (`/streamer/campaigns`)

**Fichier** : `frontend/pages/streamer/campaigns.vue`

**Modifications** :
- Liste des invitations : layout vertical sur mobile
- Boutons Accept/Decline : taille adaptée ou icônes seules

### 4.3 Page Overlay Studio - Message Limitation

**Fichier** : `frontend/pages/streamer/studio.vue`

**Modification majeure** :
- Détecter si mobile/tablette (`< lg`)
- Afficher un message plein écran :
  ```
  "L'éditeur d'overlay est optimisé pour les écrans larges.
   Veuillez utiliser un ordinateur pour accéder à cette fonctionnalité."
  ```
- Bouton "Retour" vers `/streamer`

---

## Phase 5 : Pages Communes - Responsive

### 5.1 Page Settings (`/settings`)

**Fichier** : `frontend/pages/settings/index.vue`

**État actuel** : `grid-cols-1 md:grid-cols-2 lg:grid-cols-3/4`

**Modifications** :
- Vérifier que le grid fonctionne bien sur mobile
- Adapter les cartes de paramètres

### 5.2 Page Login (`/login`)

**Fichier** : `frontend/pages/login.vue`

**État actuel** : `max-w-md` centré

**Modifications** :
- Ajouter padding latéral sur mobile (`px-4`)
- Vérifier le bouton Twitch

### 5.3 Page About (`/about`)

**Fichier** : `frontend/pages/about.vue`

**État actuel** : `grid-cols-1 md:grid-cols-2`

**Modifications** :
- Vérifier le responsive existant
- Adapter si nécessaire

---

## Phase 6 : Composants Globaux - Responsive

### 6.1 AppHeader

**Fichier** : `frontend/components/AppHeader.vue`

**État actuel** :
- Logo adaptatif (`size-10 sm:size-12`)
- Titre masqué sur mobile (`hidden sm:block`)

**Modifications** :
- Simplifier encore plus sur mobile si bottom bar présente
- Peut-être masquer le UserMenu et le mettre dans la bottom bar (onglet Réglages)

### 6.2 AppFooter

**Fichier** : `frontend/components/AppFooter.vue`

**État actuel** : `grid-cols-1 sm:grid-cols-2 lg:grid-cols-4`

**Modifications** :
- Vérifier le padding sur mobile
- Possibilité de masquer sur mobile (`hidden lg:block`) si la bottom bar suffit
- Ou réduire le contenu sur mobile (version minimale)

### 6.3 Modals

**Fichiers concernés** :
- `frontend/components/mj/PollResultsModal.vue`
- `frontend/components/mj/DeletePollModal.vue`
- `frontend/components/WaitingListModal.vue`
- Autres modals...

**Modifications** :
- Largeur : `w-full max-w-lg` avec `mx-4` sur mobile
- Ou modal plein écran sur mobile (`fixed inset-0` au lieu de centré)

### 6.4 Dropdowns

**Fichiers concernés** :
- `frontend/components/mj/CampaignDropdown.vue`
- `frontend/components/mj/AddEventDropdown.vue`
- `frontend/components/mj/EventActionsDropdown.vue`

**Modifications** :
- Vérifier que les dropdowns ne débordent pas sur mobile
- Position : `position: fixed` avec calcul de position

---

## Phase 7 : CSS & Utilities

### 7.1 Nouvelles Classes Utilitaires

**Fichier** : `frontend/assets/css/main.css`

```css
/* Safe areas pour PWA */
.safe-area-top { padding-top: env(safe-area-inset-top); }
.safe-area-bottom { padding-bottom: env(safe-area-inset-bottom); }
.safe-area-left { padding-left: env(safe-area-inset-left); }
.safe-area-right { padding-right: env(safe-area-inset-right); }

/* Hauteur viewport mobile (évite les problèmes avec la barre d'adresse) */
.min-h-screen-mobile { min-height: 100dvh; }

/* Touch targets minimum 44px */
.touch-target { min-height: 44px; min-width: 44px; }
```

### 7.2 Breakpoints Personnalisés

Vérifier la configuration Tailwind dans `tailwind.config.ts` :
```javascript
theme: {
  screens: {
    'xs': '375px',   // iPhone SE
    'sm': '640px',   // Mobile landscape / Small tablet
    'md': '768px',   // Tablet portrait
    'lg': '1024px',  // Tablet landscape / Small desktop
    'xl': '1280px',  // Desktop
    '2xl': '1536px', // Large desktop
  }
}
```

---

## Phase 8 : Tests & Validation

### 8.1 Devices à Tester

| Device | Viewport | Priorité |
|--------|----------|----------|
| iPhone SE | 375x667 | Haute |
| iPhone 14 | 390x844 | Haute |
| iPhone 14 Pro Max | 430x932 | Moyenne |
| iPad Mini | 768x1024 | Haute |
| iPad Pro 11" | 834x1194 | Moyenne |
| iPad Pro 12.9" | 1024x1366 | Moyenne |
| Desktop 1280px | 1280x800 | Haute |
| Desktop 1920px | 1920x1080 | Haute |

### 8.2 Checklist par Page

Pour chaque page, vérifier :
- [ ] Pas de scroll horizontal
- [ ] Textes lisibles (min 14px)
- [ ] Touch targets min 44px
- [ ] Boutons accessibles au pouce
- [ ] Modals ne débordent pas
- [ ] Forms utilisables
- [ ] Navigation fluide

### 8.3 PWA Testing

- [ ] Installation sur Chrome desktop (Windows/Mac)
- [ ] Installation sur Safari iOS
- [ ] Installation sur Chrome Android
- [ ] Bannière d'installation s'affiche
- [ ] Bouton menu fonctionne
- [ ] App se lance en mode standalone
- [ ] Icônes correctes
- [ ] Splash screens iOS

---

## Ordre d'Implémentation Recommandé

### Sprint 1 : Infrastructure (Fondations)
1. [ ] Créer `usePwaInstall.ts`
2. [ ] Créer `PwaInstallPrompt.vue`
3. [ ] Modifier `UserMenu.vue` (bouton installer)
4. [ ] Créer `BottomNavigation.vue`
5. [ ] Modifier `authenticated.vue` (intégrer bottom nav)
6. [ ] Ajouter CSS safe-area

### Sprint 2 : Pages MJ
7. [ ] Adapter `PollControlCard` (grid responsive)
8. [ ] Adapter `EventRow` (taille, truncate)
9. [ ] Adapter `CampaignDashboard` (hauteurs)
10. [ ] Adapter page création campaign
11. [ ] Adapter page détail campaign
12. [ ] Adapter pages création/édition poll

### Sprint 3 : Pages Streamer
13. [ ] Adapter page streamer index
14. [ ] Adapter page campaigns/invitations
15. [ ] Ajouter message limitation Overlay Studio

### Sprint 4 : Finitions
16. [ ] Adapter tous les modals
17. [ ] Vérifier tous les dropdowns
18. [ ] Adapter header/footer pour mobile
19. [ ] Adapter page settings
20. [ ] Adapter page login/about

### Sprint 5 : Tests
21. [ ] Tests sur devices réels/émulateurs
22. [ ] Corrections bugs responsive
23. [ ] Tests PWA installation
24. [ ] Validation finale

---

## Notes Techniques

### Détection Mobile

```typescript
// composables/useDevice.ts
export function useDevice() {
  const isMobile = computed(() => window.innerWidth < 640)
  const isTablet = computed(() => window.innerWidth >= 640 && window.innerWidth < 1024)
  const isDesktop = computed(() => window.innerWidth >= 1024)

  return { isMobile, isTablet, isDesktop }
}
```

### PWA Install Event Types

```typescript
// types/pwa.d.ts
interface BeforeInstallPromptEvent extends Event {
  prompt(): Promise<void>
  userChoice: Promise<{ outcome: 'accepted' | 'dismissed' }>
}

declare global {
  interface WindowEventMap {
    beforeinstallprompt: BeforeInstallPromptEvent
  }
}
```

---

## Inventaire des Fichiers à Modifier

### Nouveaux Fichiers (6)
| Fichier | Description |
|---------|-------------|
| `composables/usePwaInstall.ts` | Gestion installation PWA |
| `composables/useDevice.ts` | Détection device type |
| `components/PwaInstallPrompt.vue` | Bannière installation |
| `components/BottomNavigation.vue` | Navigation mobile |
| `types/pwa.d.ts` | Types PWA |

### Fichiers à Modifier (20+)
| Fichier | Modifications |
|---------|---------------|
| `layouts/authenticated.vue` | Bottom nav + padding |
| `assets/css/main.css` | Safe area classes |
| `components/UserMenu.vue` | Bouton installer |
| `components/AppHeader.vue` | Simplification mobile |
| `components/AppFooter.vue` | Hide/adapt mobile |
| `components/mj/CampaignDashboard.vue` | Heights responsive |
| `components/mj/EventsCard.vue` | Padding + bouton |
| `components/mj/EventRow.vue` | Height + truncate |
| `components/PollControlCard.vue` | Grid responsive |
| `pages/mj/index.vue` | Ordre mobile |
| `pages/mj/campaigns/create.vue` | Width responsive |
| `pages/mj/campaigns/[id]/index.vue` | Layout membres |
| `pages/mj/campaigns/[id]/polls/create.vue` | Form responsive |
| `pages/mj/campaigns/[id]/polls/[pollId]/edit.vue` | Form responsive |
| `pages/streamer/index.vue` | Buttons responsive |
| `pages/streamer/campaigns.vue` | List responsive |
| `pages/streamer/studio.vue` | Message limitation |
| `pages/settings/index.vue` | Grid verification |
| `pages/login.vue` | Padding mobile |
| Tous les modals | Width responsive |
